title User Cancel Ticket Sequence Diagram

actor User
boundary TicketSystem
control TicketService
entity Ticket
entity Event
entity TicketInfo

note right of User: 1. The user initiates the ticket cancellation.
User ->> TicketSystem : cancelTicket(userEmail: String, eventId: String)

activate TicketSystem
note right of TicketSystem: 2. The system forwards the request to the TicketService.
    TicketSystem ->> TicketService : cancelTicket(userEmail: String, eventId: String)
    activate TicketService

note right of TicketService: 3. The service checks if the cancellation is within the allowed time frame.
    TicketService ->> Event : checkCancellationTime(eventId: String)
    activate Event
    Event --> TicketService : return isCancellable
    deactivate Event

alt isCancellable == true
    note right of TicketService: 4. Cancellation is allowed, proceed with canceling the ticket.
    TicketService ->> Ticket : cancelTicket(userEmail: String, eventId: String)
    activate Ticket
    Ticket --> TicketService : return cancelled
    deactivate Ticket

    note right of TicketService: 5. Update ticket information (numberAvailable and numberSold).
    TicketService ->> TicketInfo : updateTicketInfo(numberAvailable: int, numberSold: int)
    activate TicketInfo
    TicketInfo --> TicketService : return updated
    deactivate TicketInfo

    TicketService -->> TicketSystem : return success
end

deactivate TicketService

note right of User: 5. The system notifies the user of the result.
TicketSystem -->> User : cancellationResult
